<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/backend/.gitignore">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/backend/.gitignore" />
              <option name="originalContent" value="*.log&#10;.DS_Store&#10;.env&#10;.env.backup&#10;.env.production&#10;.phpactor.json&#10;.phpunit.result.cache&#10;/.fleet&#10;/.idea&#10;/.nova&#10;/.phpunit.cache&#10;/.vscode&#10;/.zed&#10;/auth.json&#10;/node_modules&#10;/public/build&#10;/public/hot&#10;/public/storage&#10;/storage/*.key&#10;/storage/pail&#10;/vendor&#10;Homestead.json&#10;Homestead.yaml&#10;Thumbs.db&#10;&#10;**/caddy&#10;frankenphp&#10;frankenphp-worker.php&#10;" />
              <option name="updatedContent" value="*.log&#10;.DS_Store&#10;.env&#10;.env.backup&#10;.env.production&#10;.phpactor.json&#10;.phpunit.result.cache&#10;/.fleet&#10;/.idea&#10;/.nova&#10;/.phpunit.cache&#10;/.vscode&#10;/.zed&#10;/auth.json&#10;/node_modules&#10;/public/hot&#10;/public/storage&#10;/storage/*.key&#10;/storage/pail&#10;/vendor&#10;Homestead.json&#10;Homestead.yaml&#10;Thumbs.db&#10;&#10;**/caddy&#10;frankenphp&#10;frankenphp-worker.php&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/backend/RAILWAY_HTTPS_CONFIG.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/backend/RAILWAY_HTTPS_CONFIG.md" />
              <option name="updatedContent" value="# Configuration Railway pour HTTPS&#10;&#10;## Variables d'environnement requises sur Railway&#10;&#10;Assurez-vous que ces variables sont configurées dans Railway :&#10;&#10;```&#10;APP_ENV=production&#10;APP_DEBUG=false&#10;APP_URL=https://alamine-production.up.railway.app&#10;&#10;# Force HTTPS&#10;FORCE_HTTPS=true&#10;ASSET_URL=https://alamine-production.up.railway.app&#10;```&#10;&#10;## Vérification&#10;&#10;Après le déploiement, vérifiez que :&#10;1. Toutes les URLs générées utilisent HTTPS&#10;2. Les assets (CSS/JS) sont chargés en HTTPS&#10;3. Les formulaires soumettent en HTTPS&#10;&#10;## Configuration appliquée&#10;&#10;- ✅ TrustProxies middleware configuré pour détecter les proxys HTTPS&#10;- ✅ URL::forceScheme('https') activé en production&#10;- ✅ Détection automatique du header X-Forwarded-Proto&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/backend/app/Http/Middleware/TrustProxies.php">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/backend/app/Http/Middleware/TrustProxies.php" />
              <option name="updatedContent" value="&lt;?php&#10;&#10;namespace App\Http\Middleware;&#10;&#10;use Illuminate\Http\Middleware\TrustProxies as Middleware;&#10;use Illuminate\Http\Request;&#10;&#10;class TrustProxies extends Middleware&#10;{&#10;    /**&#10;     * The trusted proxies for this application.&#10;     *&#10;     * @var array&lt;int, string&gt;|string|null&#10;     */&#10;    protected $proxies = '*'; // Trust all proxies (for Railway, Heroku, etc.)&#10;&#10;    /**&#10;     * The headers that should be used to detect proxies.&#10;     *&#10;     * @var int&#10;     */&#10;    protected $headers =&#10;        Request::HEADER_X_FORWARDED_FOR |&#10;        Request::HEADER_X_FORWARDED_HOST |&#10;        Request::HEADER_X_FORWARDED_PORT |&#10;        Request::HEADER_X_FORWARDED_PROTO |&#10;        Request::HEADER_X_FORWARDED_AWS_ELB;&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/backend/app/Providers/AppServiceProvider.php">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/backend/app/Providers/AppServiceProvider.php" />
              <option name="originalContent" value="&lt;?php&#10;&#10;namespace App\Providers;&#10;&#10;use Illuminate\Support\ServiceProvider;&#10;&#10;class AppServiceProvider extends ServiceProvider&#10;{&#10;    /**&#10;     * Register any application services.&#10;     */&#10;    public function register(): void&#10;    {&#10;        //&#10;    }&#10;&#10;    /**&#10;     * Bootstrap any application services.&#10;     */&#10;    public function boot(): void&#10;    {&#10;        if (config('app.env') === 'production') {&#10;            \Illuminate\Support\Facades\URL::forceScheme('https');&#10;&#10;            // Configure Vite for production&#10;            \Illuminate\Support\Facades\Vite::useScriptTagAttributes([&#10;                'defer' =&gt; true,&#10;            ]);&#10;&#10;            // Add preloading for critical assets&#10;            \Illuminate\Support\Facades\Vite::usePreloadTag();&#10;&#10;            // Add Content Security Policy nonce&#10;            \Illuminate\Support\Facades\Vite::useCspNonce();&#10;&#10;            // Make sure asset URLs are absolute&#10;            \Illuminate\Support\Facades\Vite::useAbsoluteAssetPaths();&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="&lt;?php&#10;&#10;namespace App\Providers;&#10;&#10;use Illuminate\Support\ServiceProvider;&#10;&#10;class AppServiceProvider extends ServiceProvider&#10;{&#10;    /**&#10;     * Register any application services.&#10;     */&#10;    public function register(): void&#10;    {&#10;        //&#10;    }&#10;&#10;    /**&#10;     * Bootstrap any application services.&#10;     */&#10;    public function boot(): void&#10;    {&#10;        // Force HTTPS in production (Railway, etc.)&#10;        if (config('app.env') === 'production') {&#10;            \Illuminate\Support\Facades\URL::forceScheme('https');&#10;        }&#10;&#10;        // Trust all proxies (for Railway and other cloud platforms)&#10;        $this-&gt;app['request']-&gt;server-&gt;set('HTTPS', 'on');&#10;        &#10;        // Configure trusted proxies for cloud platforms&#10;        if (isset($_SERVER['HTTP_X_FORWARDED_PROTO']) &amp;&amp; $_SERVER['HTTP_X_FORWARDED_PROTO'] === 'https') {&#10;            \Illuminate\Support\Facades\URL::forceScheme('https');&#10;        }&#10;&#10;        if (config('app.env') === 'production') {&#10;            // Configure Vite for production&#10;            \Illuminate\Support\Facades\Vite::useScriptTagAttributes([&#10;                'defer' =&gt; true,&#10;            ]);&#10;&#10;            // Add preloading for critical assets&#10;            \Illuminate\Support\Facades\Vite::usePreloadTag();&#10;&#10;            // Add Content Security Policy nonce&#10;            \Illuminate\Support\Facades\Vite::useCspNonce();&#10;&#10;            // Make sure asset URLs are absolute&#10;            \Illuminate\Support\Facades\Vite::useAbsoluteAssetPaths();&#10;        }&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/backend/bootstrap/app.php">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/backend/bootstrap/app.php" />
              <option name="originalContent" value="&lt;?php&#10;&#10;use Illuminate\Foundation\Application;&#10;use Illuminate\Foundation\Configuration\Exceptions;&#10;use Illuminate\Foundation\Configuration\Middleware;&#10;&#10;return Application::configure(basePath: dirname(__DIR__))&#10;    -&gt;withRouting(&#10;        web: __DIR__.'/../routes/web.php',&#10;        api: __DIR__.'/../routes/api.php',&#10;        commands: __DIR__.'/../routes/console.php',&#10;        health: '/up',&#10;    )&#10;    -&gt;withMiddleware(function (Middleware $middleware): void {&#10;        $middleware-&gt;alias([&#10;            'role' =&gt; \App\Http\Middleware\CheckRole::class,&#10;        ]);&#10;        &#10;        // Exclure les routes PayDunya du CSRF pour les webhooks&#10;        $middleware-&gt;validateCsrfTokens(except: [&#10;            'paydunya/*',&#10;            'patient/stripe/webhook',&#10;            'api/*', // Exclude all API routes from CSRF&#10;        ]);&#10;&#10;        // Configure CORS for Angular frontend&#10;        $middleware-&gt;api(prepend: [&#10;            \Laravel\Sanctum\Http\Middleware\EnsureFrontendRequestsAreStateful::class,&#10;        ]);&#10;    })&#10;    -&gt;withExceptions(function (Exceptions $exceptions): void {&#10;        //&#10;    })-&gt;create();&#10;" />
              <option name="updatedContent" value="&lt;?php&#10;&#10;use Illuminate\Foundation\Application;&#10;use Illuminate\Foundation\Configuration\Exceptions;&#10;use Illuminate\Foundation\Configuration\Middleware;&#10;&#10;return Application::configure(basePath: dirname(__DIR__))&#10;    -&gt;withRouting(&#10;        web: __DIR__.'/../routes/web.php',&#10;        api: __DIR__.'/../routes/api.php',&#10;        commands: __DIR__.'/../routes/console.php',&#10;        health: '/up',&#10;    )&#10;    -&gt;withMiddleware(function (Middleware $middleware): void {&#10;        // Trust proxies for HTTPS detection (Railway, Heroku, etc.)&#10;        $middleware-&gt;trustProxies(at: '*');&#10;        &#10;        $middleware-&gt;alias([&#10;            'role' =&gt; \App\Http\Middleware\CheckRole::class,&#10;        ]);&#10;        &#10;        // Exclure les routes PayDunya du CSRF pour les webhooks&#10;        $middleware-&gt;validateCsrfTokens(except: [&#10;            'paydunya/*',&#10;            'patient/stripe/webhook',&#10;            'api/*', // Exclude all API routes from CSRF&#10;        ]);&#10;&#10;        // Configure CORS for Angular frontend&#10;        $middleware-&gt;api(prepend: [&#10;            \Laravel\Sanctum\Http\Middleware\EnsureFrontendRequestsAreStateful::class,&#10;        ]);&#10;    })&#10;    -&gt;withExceptions(function (Exceptions $exceptions): void {&#10;        //&#10;    })-&gt;create();&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>