<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/backend/GUIDE_LWS_RAILWAY.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/backend/GUIDE_LWS_RAILWAY.md" />
              <option name="originalContent" value="# Guide pas à pas : Configuration DNS LWS pour Railway&#10;&#10;##  Étape par étape avec l'interface LWS que vous avez&#10;&#10;### 1️⃣ Dans l'interface LWS que vous voyez actuellement&#10;&#10;Cliquez sur **&quot;Zone DNS&quot;** (l'icône avec le globe et les engrenages)&#10;&#10;### 2️⃣ Sur la page Zone DNS&#10;&#10;Vous allez voir une liste de vos enregistrements DNS actuels. Cherchez le bouton **&quot;Ajouter un enregistrement&quot;** ou **&quot;+&quot;**&#10;&#10;### 3️⃣ Ajouter l'enregistrement CNAME&#10;&#10;Remplissez le formulaire comme suit :&#10;&#10;```&#10;┌─────────────────────────────────────────────┐&#10;│ Type d'enregistrement : CNAME               │&#10;├─────────────────────────────────────────────┤&#10;│ Nom (ou Sous-domaine) : api                 │&#10;│  (ou alamine, backend, app, etc.)           │&#10;├─────────────────────────────────────────────┤&#10;│ Valeur (ou Cible) :                         │&#10;│  alamine-production.up.railway.app          │&#10;├─────────────────────────────────────────────┤&#10;│ TTL : 3600                                  │&#10;│  (ou laisser la valeur par défaut)          │&#10;└─────────────────────────────────────────────┘&#10;```&#10;&#10;### 4️⃣ Cliquez sur &quot;Enregistrer&quot; ou &quot;Ajouter&quot;&#10;&#10;### 5️⃣ Vérification immédiate sur LWS&#10;&#10;Après enregistrement, vous devriez voir une nouvelle ligne dans votre Zone DNS :&#10;&#10;```&#10;Type    Nom/Sous-domaine    Valeur/Cible                          TTL&#10;──────────────────────────────────────────────────────────────────────&#10;CNAME   api                 alamine-production.up.railway.app     3600&#10;```&#10;&#10;##  Ensuite : Configuration sur Railway&#10;&#10;### 1️⃣ Ouvrez Railway&#10;- Allez sur https://railway.app&#10;- Connectez-vous à votre compte&#10;- Ouvrez le projet **al_amine**&#10;&#10;### 2️⃣ Accédez aux paramètres du service&#10;- Cliquez sur votre service **backend** (ou **web**)&#10;- Cliquez sur l'onglet **&quot;Settings&quot;**&#10;- Scrollez jusqu'à **&quot;Networking&quot;**&#10;&#10;### 3️⃣ Ajoutez le domaine personnalisé&#10;- Dans la section **&quot;Domains&quot;** ou **&quot;Custom Domain&quot;**&#10;- Cliquez sur **&quot;+ Custom Domain&quot;** ou **&quot;Add Domain&quot;**&#10;- Entrez : `api.votredomaine.com` (remplacez par votre vrai domaine)&#10;- Cliquez sur **&quot;Add&quot;**&#10;&#10;### 4️⃣ Attendez la validation&#10;Railway va vérifier que le DNS pointe bien vers eux :&#10;- ⏳ En cours... (cercle qui tourne)&#10;- ⚠️ Pending (DNS pas encore propagé)&#10;- ✅ Active (Tout est bon !)&#10;&#10;**Temps d'attente typique : 5 à 30 minutes**&#10;&#10;### 5️⃣ Mettez à jour les variables d'environnement&#10;Une fois le domaine validé (✅) :&#10;&#10;1. Toujours dans **Settings**, allez dans la section **&quot;Variables&quot;**&#10;2. Modifiez ou ajoutez ces variables :&#10;&#10;```&#10;APP_URL=https://api.votredomaine.com&#10;ASSET_URL=https://api.votredomaine.com&#10;```&#10;&#10;3. Railway va automatiquement redéployer l'application&#10;&#10;##  Vérification finale&#10;&#10;### Test 1 : Accès au site&#10;Ouvrez votre navigateur et allez sur :&#10;```&#10;https://api.votredomaine.com/patient/dashboard&#10;```&#10;&#10;### Test 2 : Vérifier le certificat SSL&#10;- Cliquez sur le cadenas  dans la barre d'adresse&#10;- Vérifiez que le certificat est valide&#10;- Émis par : Let's Encrypt&#10;&#10;### Test 3 : Console du navigateur&#10;- Appuyez sur F12 pour ouvrir la console&#10;- Vérifiez qu'il n'y a **AUCUNE** erreur &quot;Mixed Content&quot;&#10;- Les assets doivent tous charger en HTTPS&#10;&#10;##  Exemple complet avec un vrai domaine&#10;&#10;Si votre domaine LWS est **`clinique-alamine.com`** :&#10;&#10;### Sur LWS (Zone DNS) :&#10;```&#10;Type: CNAME&#10;Nom: api&#10;Valeur: alamine-production.up.railway.app&#10;TTL: 3600&#10;```&#10;&#10;### Sur Railway (Custom Domain) :&#10;```&#10;Domaine: api.clinique-alamine.com&#10;```&#10;&#10;### Variables d'environnement Railway :&#10;```&#10;APP_URL=https://api.clinique-alamine.com&#10;ASSET_URL=https://api.clinique-alamine.com&#10;```&#10;&#10;### Résultat :&#10;Votre site sera accessible sur : **https://api.clinique-alamine.com**&#10;&#10;## ❓ Problèmes courants&#10;&#10;### &quot;Domain not verified&quot; sur Railway après 1 heure&#10;**Solution :**&#10;```bash&#10;# Vérifiez que le DNS est propagé&#10;dig api.votredomaine.com&#10;&#10;# Ou utilisez un site web&#10;https://www.whatsmydns.net&#10;```&#10;&#10;Si le DNS ne pointe pas vers Railway, revérifiez la configuration sur LWS&#10;&#10;### Erreur &quot;Too many redirects&quot;&#10;**Solution :**&#10;- Vérifiez que `APP_URL` commence par `https://` (pas `http://`)&#10;- Vérifiez qu'il n'y a pas de redirection forcée dans LWS (section &quot;Redirection web&quot;)&#10;&#10;### Le site charge mais CSS/JS ne fonctionne pas&#10;**Solution :**&#10;- Videz le cache : Ctrl + Shift + R&#10;- Vérifiez que `ASSET_URL` est défini sur Railway&#10;- Redéployez l'application sur Railway&#10;&#10;##  Une fois terminé&#10;&#10;Vous aurez :&#10;- ✅ Un domaine professionnel (api.votredomaine.com)&#10;- ✅ HTTPS automatique avec Let's Encrypt&#10;- ✅ Plus d'erreur &quot;Mixed Content&quot;&#10;- ✅ Certificat SSL renouvelé automatiquement&#10;&#10;---&#10;&#10;**Besoin d'aide ?**&#10;Si vous bloquez à une étape, notez :&#10;1. À quelle étape vous êtes bloqué&#10;2. Le message d'erreur exact (si erreur)&#10;3. Votre nom de domaine LWS&#10;&#10;" />
              <option name="updatedContent" value="# Guide pas à pas : Configuration DNS LWS pour Railway&#10;&#10;##  Étape par étape avec l'interface LWS que vous avez&#10;&#10;### 1️⃣ Dans l'interface LWS que vous voyez actuellement&#10;&#10;Cliquez sur **&quot;Zone DNS&quot;** (l'icône avec le globe et les engrenages)&#10;&#10;### 2️⃣ Sur la page Zone DNS&#10;&#10;Vous allez voir une liste de vos enregistrements DNS actuels. Cherchez le bouton **&quot;Ajouter un enregistrement&quot;** ou **&quot;+&quot;**&#10;&#10;### 3️⃣ Ajouter l'enregistrement CNAME&#10;&#10;⚠️ **IMPORTANT : Utilisez EXACTEMENT la valeur fournie par Railway !**&#10;&#10;Railway vous a donné cette valeur : **`43fmkiyn.up.railway.app`**&#10;&#10;Remplissez le formulaire sur LWS comme suit :&#10;&#10;```&#10;┌─────────────────────────────────────────────┐&#10;│ Type d'enregistrement : CNAME               │&#10;├─────────────────────────────────────────────┤&#10;│ Nom (ou Sous-domaine) :                     │&#10;│  - Pour un sous-domaine : api               │&#10;│  - Pour domaine racine : @ ou www           │&#10;├─────────────────────────────────────────────┤&#10;│ Valeur (ou Cible) :                         │&#10;│  43fmkiyn.up.railway.app                    │&#10;│  ⚠️ COPIEZ EXACTEMENT cette valeur          │&#10;├─────────────────────────────────────────────┤&#10;│ TTL : 3600                                  │&#10;│  (ou laisser la valeur par défaut)          │&#10;└─────────────────────────────────────────────┘&#10;```&#10;&#10; **Note** : Railway génère une valeur unique pour chaque projet. N'utilisez PAS `alamine-production.up.railway.app`, utilisez **`43fmkiyn.up.railway.app`** comme indiqué sur votre écran Railway.&#10;&#10;### 4️⃣ Cliquez sur &quot;Enregistrer&quot; ou &quot;Ajouter&quot;&#10;&#10;### 5️⃣ Vérification immédiate sur LWS&#10;&#10;Après enregistrement, vous devriez voir une nouvelle ligne dans votre Zone DNS :&#10;&#10;```&#10;Type    Nom/Sous-domaine    Valeur/Cible                TTL&#10;────────────────────────────────────────────────────────────&#10;CNAME   api                 43fmkiyn.up.railway.app     3600&#10;```&#10;&#10;##  Ensuite : Configuration sur Railway&#10;&#10;### 1️⃣ Ouvrez Railway&#10;- Allez sur https://railway.app&#10;- Connectez-vous à votre compte&#10;- Ouvrez le projet **al_amine**&#10;&#10;### 2️⃣ Accédez aux paramètres du service&#10;- Cliquez sur votre service **backend** (ou **web**)&#10;- Cliquez sur l'onglet **&quot;Settings&quot;**&#10;- Scrollez jusqu'à **&quot;Networking&quot;**&#10;&#10;### 3️⃣ Ajoutez le domaine personnalisé&#10;- Dans la section **&quot;Domains&quot;** ou **&quot;Custom Domain&quot;**&#10;- Cliquez sur **&quot;+ Custom Domain&quot;** ou **&quot;Add Domain&quot;**&#10;- Entrez : `api.votredomaine.com` (remplacez par votre vrai domaine)&#10;- Cliquez sur **&quot;Add&quot;**&#10;&#10;### 4️⃣ Attendez la validation&#10;Railway va vérifier que le DNS pointe bien vers eux :&#10;- ⏳ En cours... (cercle qui tourne)&#10;- ⚠️ Pending (DNS pas encore propagé)&#10;- ✅ Active (Tout est bon !)&#10;&#10;**Temps d'attente typique : 5 à 30 minutes**&#10;&#10;### 5️⃣ Mettez à jour les variables d'environnement&#10;Une fois le domaine validé (✅) :&#10;&#10;1. Toujours dans **Settings**, allez dans la section **&quot;Variables&quot;**&#10;2. Modifiez ou ajoutez ces variables :&#10;&#10;```&#10;APP_URL=https://api.votredomaine.com&#10;ASSET_URL=https://api.votredomaine.com&#10;```&#10;&#10;3. Railway va automatiquement redéployer l'application&#10;&#10;##  Vérification finale&#10;&#10;### Test 1 : Accès au site&#10;Ouvrez votre navigateur et allez sur :&#10;```&#10;https://api.votredomaine.com/patient/dashboard&#10;```&#10;&#10;### Test 2 : Vérifier le certificat SSL&#10;- Cliquez sur le cadenas  dans la barre d'adresse&#10;- Vérifiez que le certificat est valide&#10;- Émis par : Let's Encrypt&#10;&#10;### Test 3 : Console du navigateur&#10;- Appuyez sur F12 pour ouvrir la console&#10;- Vérifiez qu'il n'y a **AUCUNE** erreur &quot;Mixed Content&quot;&#10;- Les assets doivent tous charger en HTTPS&#10;&#10;##  Exemple complet avec un vrai domaine&#10;&#10;Si votre domaine LWS est **`clinique-alamine.com`** :&#10;&#10;### Sur LWS (Zone DNS) :&#10;```&#10;Type: CNAME&#10;Nom: api&#10;Valeur: 43fmkiyn.up.railway.app&#10;TTL: 3600&#10;```&#10;&#10;### Sur Railway (Custom Domain) :&#10;```&#10;Domaine: api.clinique-alamine.com&#10;```&#10;&#10;### Variables d'environnement Railway :&#10;```&#10;APP_URL=https://api.clinique-alamine.com&#10;ASSET_URL=https://api.clinique-alamine.com&#10;```&#10;&#10;### Résultat :&#10;Votre site sera accessible sur : **https://api.clinique-alamine.com**&#10;&#10;## ❓ Problèmes courants&#10;&#10;### &quot;Domain not verified&quot; sur Railway après 1 heure&#10;**Solution :**&#10;```bash&#10;# Vérifiez que le DNS est propagé&#10;dig api.votredomaine.com&#10;&#10;# Ou utilisez un site web&#10;https://www.whatsmydns.net&#10;```&#10;&#10;Si le DNS ne pointe pas vers Railway, revérifiez la configuration sur LWS&#10;&#10;### Erreur &quot;Too many redirects&quot;&#10;**Solution :**&#10;- Vérifiez que `APP_URL` commence par `https://` (pas `http://`)&#10;- Vérifiez qu'il n'y a pas de redirection forcée dans LWS (section &quot;Redirection web&quot;)&#10;&#10;### Le site charge mais CSS/JS ne fonctionne pas&#10;**Solution :**&#10;- Videz le cache : Ctrl + Shift + R&#10;- Vérifiez que `ASSET_URL` est défini sur Railway&#10;- Redéployez l'application sur Railway&#10;&#10;##  Une fois terminé&#10;&#10;Vous aurez :&#10;- ✅ Un domaine professionnel (api.votredomaine.com)&#10;- ✅ HTTPS automatique avec Let's Encrypt&#10;- ✅ Plus d'erreur &quot;Mixed Content&quot;&#10;- ✅ Certificat SSL renouvelé automatiquement&#10;&#10;---&#10;&#10;**Besoin d'aide ?**&#10;Si vous bloquez à une étape, notez :&#10;1. À quelle étape vous êtes bloqué&#10;2. Le message d'erreur exact (si erreur)&#10;3. Votre nom de domaine LWS&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/backend/RAILWAY_VARIABLES_ENV.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/backend/RAILWAY_VARIABLES_ENV.md" />
              <option name="updatedContent" value="# Railway Configuration - Variables d'environnement requises&#10;&#10;##  IMPORTANT : Configurez ces variables sur Railway&#10;&#10;Pour résoudre le problème &quot;Mixed Content&quot; (HTTP vs HTTPS), vous DEVEZ configurer ces variables d'environnement sur Railway :&#10;&#10;### Variables à ajouter/modifier sur Railway :&#10;&#10;```bash&#10;APP_ENV=production&#10;APP_DEBUG=false&#10;APP_URL=https://alamine-production.up.railway.app&#10;ASSET_URL=https://alamine-production.up.railway.app&#10;&#10;# Force HTTPS (important !)&#10;FORCE_HTTPS=true&#10;```&#10;&#10;### Si vous utilisez votre domaine personnalisé (al-amine.online) :&#10;&#10;Une fois que le DNS sera propagé et validé par Railway, changez :&#10;&#10;```bash&#10;APP_URL=https://al-amine.online&#10;ASSET_URL=https://al-amine.online&#10;```&#10;&#10;## Comment configurer sur Railway :&#10;&#10;1. Allez sur https://railway.app&#10;2. Ouvrez votre projet **al_amine**&#10;3. Cliquez sur votre service (backend)&#10;4. Allez dans **Variables**&#10;5. Ajoutez/modifiez ces variables&#10;6. Railway redéploiera automatiquement&#10;&#10;## Vérification :&#10;&#10;Après le redéploiement, ouvrez votre site et vérifiez la console (F12). Il ne devrait plus y avoir d'erreurs &quot;Mixed Content&quot;.&#10;&#10;## Note importante :&#10;&#10;Le code a été modifié pour forcer HTTPS partout :&#10;- ✅ AppServiceProvider force HTTPS&#10;- ✅ TrustProxies configuré&#10;- ✅ .htaccess redirige HTTP → HTTPS&#10;- ✅ Toutes les URLs générées seront en HTTPS&#10;&#10;Mais les **variables d'environnement** doivent absolument commencer par `https://` !&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/backend/app/Providers/AppServiceProvider.php">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/backend/app/Providers/AppServiceProvider.php" />
              <option name="originalContent" value="&lt;?php&#10;&#10;namespace App\Providers;&#10;&#10;use Illuminate\Support\ServiceProvider;&#10;&#10;class AppServiceProvider extends ServiceProvider&#10;{&#10;    /**&#10;     * Register any application services.&#10;     */&#10;    public function register(): void&#10;    {&#10;        //&#10;    }&#10;&#10;    /**&#10;     * Bootstrap any application services.&#10;     */&#10;    public function boot(): void&#10;    {&#10;        // Force HTTPS in production (Railway, etc.)&#10;        if (config('app.env') === 'production') {&#10;            \Illuminate\Support\Facades\URL::forceScheme('https');&#10;        }&#10;&#10;        // Trust all proxies (for Railway and other cloud platforms)&#10;        $this-&gt;app['request']-&gt;server-&gt;set('HTTPS', 'on');&#10;&#10;        // Configure trusted proxies for cloud platforms&#10;        if (isset($_SERVER['HTTP_X_FORWARDED_PROTO']) &amp;&amp; $_SERVER['HTTP_X_FORWARDED_PROTO'] === 'https') {&#10;            \Illuminate\Support\Facades\URL::forceScheme('https');&#10;        }&#10;&#10;        if (config('app.env') === 'production') {&#10;            // Configure Vite for production&#10;            \Illuminate\Support\Facades\Vite::useScriptTagAttributes([&#10;                'defer' =&gt; true,&#10;            ]);&#10;&#10;            // Add preloading for critical assets&#10;            \Illuminate\Support\Facades\Vite::usePreloadTag();&#10;&#10;            // Add Content Security Policy nonce&#10;            \Illuminate\Support\Facades\Vite::useCspNonce();&#10;&#10;            // Make sure asset URLs are absolute&#10;            \Illuminate\Support\Facades\Vite::useAbsoluteAssetPaths();&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="&lt;?php&#10;&#10;namespace App\Providers;&#10;&#10;use Illuminate\Support\ServiceProvider;&#10;&#10;class AppServiceProvider extends ServiceProvider&#10;{&#10;    /**&#10;     * Register any application services.&#10;     */&#10;    public function register(): void&#10;    {&#10;        //&#10;    }&#10;&#10;    /**&#10;     * Bootstrap any application services.&#10;     */&#10;    public function boot(): void&#10;    {&#10;        // Force HTTPS for all environments (Railway requires this)&#10;        \Illuminate\Support\Facades\URL::forceScheme('https');&#10;        &#10;        // Trust all proxies (for Railway and other cloud platforms)&#10;        $this-&gt;app['request']-&gt;server-&gt;set('HTTPS', 'on');&#10;        &#10;        // Force root URL to HTTPS&#10;        if (config('app.url')) {&#10;            $appUrl = config('app.url');&#10;            if (strpos($appUrl, 'http://') === 0) {&#10;                config(['app.url' =&gt; str_replace('http://', 'https://', $appUrl)]);&#10;            }&#10;        }&#10;        &#10;        // Configure trusted proxies for cloud platforms&#10;        if (isset($_SERVER['HTTP_X_FORWARDED_PROTO']) &amp;&amp; $_SERVER['HTTP_X_FORWARDED_PROTO'] === 'https') {&#10;            \Illuminate\Support\Facades\URL::forceScheme('https');&#10;        }&#10;&#10;        if (config('app.env') === 'production') {&#10;            // Configure Vite for production&#10;            \Illuminate\Support\Facades\Vite::useScriptTagAttributes([&#10;                'defer' =&gt; true,&#10;            ]);&#10;&#10;            // Add preloading for critical assets&#10;            \Illuminate\Support\Facades\Vite::usePreloadTag();&#10;&#10;            // Add Content Security Policy nonce&#10;            \Illuminate\Support\Facades\Vite::useCspNonce();&#10;&#10;            // Make sure asset URLs are absolute&#10;            \Illuminate\Support\Facades\Vite::useAbsoluteAssetPaths();&#10;        }&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/backend/public/.htaccess">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/backend/public/.htaccess" />
              <option name="originalContent" value="&lt;IfModule mod_rewrite.c&gt;&#10;    &lt;IfModule mod_negotiation.c&gt;&#10;        Options -MultiViews -Indexes&#10;    &lt;/IfModule&gt;&#10;&#10;    RewriteEngine On&#10;&#10;    # Handle Authorization Header&#10;    RewriteCond %{HTTP:Authorization} .&#10;    RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]&#10;&#10;    # Handle X-XSRF-Token Header&#10;    RewriteCond %{HTTP:x-xsrf-token} .&#10;    RewriteRule .* - [E=HTTP_X_XSRF_TOKEN:%{HTTP:X-XSRF-Token}]&#10;&#10;    # Redirect Trailing Slashes If Not A Folder...&#10;    RewriteCond %{REQUEST_FILENAME} !-d&#10;    RewriteCond %{REQUEST_URI} (.+)/$&#10;    RewriteRule ^ %1 [L,R=301]&#10;&#10;    # Send Requests To Front Controller...&#10;    RewriteCond %{REQUEST_FILENAME} !-d&#10;    RewriteCond %{REQUEST_FILENAME} !-f&#10;    RewriteRule ^ index.php [L]&#10;&lt;/IfModule&gt;&#10;" />
              <option name="updatedContent" value="&lt;IfModule mod_rewrite.c&gt;&#10;    &lt;IfModule mod_negotiation.c&gt;&#10;        Options -MultiViews -Indexes&#10;    &lt;/IfModule&gt;&#10;&#10;    RewriteEngine On&#10;&#10;    # Force HTTPS&#10;    RewriteCond %{HTTPS} off&#10;    RewriteCond %{HTTP:X-Forwarded-Proto} !https&#10;    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]&#10;&#10;    # Handle Authorization Header&#10;    RewriteCond %{HTTP:Authorization} .&#10;    RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]&#10;&#10;    # Handle X-XSRF-Token Header&#10;    RewriteCond %{HTTP:x-xsrf-token} .&#10;    RewriteRule .* - [E=HTTP_X_XSRF_TOKEN:%{HTTP:X-XSRF-Token}]&#10;&#10;    # Redirect Trailing Slashes If Not A Folder...&#10;    RewriteCond %{REQUEST_FILENAME} !-d&#10;    RewriteCond %{REQUEST_URI} (.+)/$&#10;    RewriteRule ^ %1 [L,R=301]&#10;&#10;    # Send Requests To Front Controller...&#10;    RewriteCond %{REQUEST_FILENAME} !-d&#10;    RewriteCond %{REQUEST_FILENAME} !-f&#10;    RewriteRule ^ index.php [L]&#10;&lt;/IfModule&gt;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>